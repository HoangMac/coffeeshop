<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1128px" preserveAspectRatio="none" style="width:1663px;height:1128px;background:#FFFFFF;" version="1.1" viewBox="0 0 1663 1128" width="1663px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="165" x="745" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="155" x="750" y="28.5352">Customer place order</text><rect fill="#FFFFFF" height="100.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="204.5" y="160.0859"/><rect fill="#FFFFFF" height="437.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="580.5" y="333.6387"/><rect fill="#F0FFFF" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="270" x="525" y="420.2598"/><rect fill="#F5DEB3" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="1010" x="525" y="493.8809"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="65" x2="65" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="209.5" x2="209.5" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="585" x2="585" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1146" x2="1146" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1305" x2="1305" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1458" x2="1458" y1="85.4648" y2="1079.4707"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1593" x2="1593" y1="85.4648" y2="1079.4707"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="5" y="53.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="12" y="74.5117">Mobile Channel</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="5" y="1078.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="12" y="1099.0059">Mobile Channel</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="156.5" y="53.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="163.5" y="74.5117">Order Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="156.5" y="1078.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="163.5" y="1099.0059">Order Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="535" y="53.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="542" y="74.5117">Shop Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="535" y="1078.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="542" y="1099.0059">Shop Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="145" x="1074" y="53.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="1081" y="74.5117">Notification Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="145" x="1074" y="1078.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="1081" y="1099.0059">Notification Service</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1229" y="53.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1236" y="74.5117">Queue Management</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1229" y="1078.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1236" y="1099.0059">Queue Management</text><path d="M1396,42.4883 L1520,42.4883 C1525,42.4883 1525,63.9766 1525,63.9766 C1525,63.9766 1525,85.4648 1520,85.4648 L1396,85.4648 C1391,85.4648 1391,63.9766 1391,63.9766 C1391,63.9766 1391,42.4883 1396,42.4883 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1520,42.4883 C1515,42.4883 1515,63.9766 1515,63.9766 C1515,85.4648 1520,85.4648 1520,85.4648 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1396" y="61.0234">Order Placement</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1430.5" y="77.5117">Queue</text><path d="M1396,1078.4707 L1520,1078.4707 C1525,1078.4707 1525,1099.959 1525,1099.959 C1525,1099.959 1525,1121.4473 1520,1121.4473 L1396,1121.4473 C1391,1121.4473 1391,1099.959 1391,1099.959 C1391,1099.959 1391,1078.4707 1396,1078.4707 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1520,1078.4707 C1515,1078.4707 1515,1099.959 1515,1099.959 C1515,1121.4473 1520,1121.4473 1520,1121.4473 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1396" y="1097.0059">Order Placement</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1430.5" y="1113.4941">Queue</text><path d="M1540,42.4883 L1646,42.4883 C1651,42.4883 1651,63.9766 1651,63.9766 C1651,63.9766 1651,85.4648 1646,85.4648 L1540,85.4648 C1535,85.4648 1535,63.9766 1535,63.9766 C1535,63.9766 1535,42.4883 1540,42.4883 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1646,42.4883 C1641,42.4883 1641,63.9766 1641,63.9766 C1641,85.4648 1646,85.4648 1646,85.4648 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="1540" y="61.0234">Order Process</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1565.5" y="77.5117">Queue</text><path d="M1540,1078.4707 L1646,1078.4707 C1651,1078.4707 1651,1099.959 1651,1099.959 C1651,1099.959 1651,1121.4473 1646,1121.4473 L1540,1121.4473 C1535,1121.4473 1535,1099.959 1535,1099.959 C1535,1099.959 1535,1078.4707 1540,1078.4707 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1646,1078.4707 C1641,1078.4707 1641,1099.959 1641,1099.959 C1641,1121.4473 1646,1121.4473 1646,1121.4473 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="1540" y="1097.0059">Order Process</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1565.5" y="1113.4941">Queue</text><rect fill="#FFFFFF" height="100.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="204.5" y="160.0859"/><rect fill="#FFFFFF" height="437.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="580.5" y="333.6387"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1656" x="0" y="116.1201"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="116.1201" y2="116.1201"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="119.1201" y2="119.1201"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="249" x="703.5" y="105.4648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="709.5" y="122.0332">Start customer place order process</text><polygon fill="#181818" points="192.5,156.0859,202.5,160.0859,192.5,164.0859,196.5,160.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="65.5" x2="198.5" y1="160.0859" y2="160.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="72.5" y="155.3438">Initialize new order</text><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="256.5" y1="189.3965" y2="189.3965"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="256.5" y1="189.3965" y2="202.3965"/><line style="stroke:#181818;stroke-width:1.0;" x1="215.5" x2="256.5" y1="202.3965" y2="202.3965"/><polygon fill="#181818" points="225.5,198.3965,215.5,202.3965,225.5,206.3965,221.5,202.3965" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="221.5" y="184.6543">Generate order id, create new record in DynamoDB</text><polygon fill="#181818" points="1446,227.707,1456,231.707,1446,235.707,1450,231.707" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="1452" y1="231.707" y2="231.707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="221.5" y="226.9648">Send message of new order to SQS queue</text><polygon fill="#181818" points="76.5,257.0176,66.5,261.0176,76.5,265.0176,72.5,261.0176" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="70.5" x2="208.5" y1="261.0176" y2="261.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="82.5" y="256.2754">Return order id</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1656" x="0" y="289.6729"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="289.6729" y2="289.6729"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="292.6729" y2="292.6729"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="267" x="694.5" y="279.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="253" x="700.5" y="295.5859">Start confirming order in background</text><polygon fill="#181818" points="1446,329.6387,1456,333.6387,1446,337.6387,1450,333.6387" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1452" y1="333.6387" y2="333.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="597.5" y="328.8965">Poll new message</text><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="632.5" y1="362.9492" y2="362.9492"/><line style="stroke:#181818;stroke-width:1.0;" x1="632.5" x2="632.5" y1="362.9492" y2="375.9492"/><line style="stroke:#181818;stroke-width:1.0;" x1="591.5" x2="632.5" y1="375.9492" y2="375.9492"/><polygon fill="#181818" points="601.5,371.9492,591.5,375.9492,601.5,379.9492,597.5,375.9492" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="597.5" y="358.207">Validate order details : item availability, calculate total cost</text><polygon fill="#181818" points="1293,401.2598,1303,405.2598,1293,409.2598,1297,405.2598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1299" y1="405.2598" y2="405.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="597.5" y="400.5176">Check for available waiting queue</text><path d="M525,420.2598 L587,420.2598 L587,427.5703 L577,437.5703 L525,437.5703 L525,420.2598 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="270" x="525" y="420.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="540" y="433.8281">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="188" x="602" y="432.8945">["Found available waiting queue"]</text><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="632.5" y1="458.8809" y2="458.8809"/><line style="stroke:#181818;stroke-width:1.0;" x1="632.5" x2="632.5" y1="458.8809" y2="471.8809"/><line style="stroke:#181818;stroke-width:1.0;" x1="591.5" x2="632.5" y1="471.8809" y2="471.8809"/><polygon fill="#181818" points="601.5,467.8809,591.5,471.8809,601.5,475.8809,597.5,471.8809" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="597.5" y="454.1387">Store order with queue id</text><path d="M525,493.8809 L587,493.8809 L587,501.1914 L577,511.1914 L525,511.1914 L525,493.8809 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="1010" x="525" y="493.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="540" y="507.4492">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="215" x="602" y="506.5156">["All queue are at maximum capacity"]</text><polygon fill="#181818" points="1446,528.502,1456,532.502,1446,536.502,1450,532.502" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1452" y1="532.502" y2="532.502"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="597.5" y="527.7598">use retry mechanism of SQS to look for available queue</text><polygon fill="#181818" points="1134.5,557.8125,1144.5,561.8125,1134.5,565.8125,1138.5,561.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1140.5" y1="561.8125" y2="561.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="532" x="597.5" y="557.0703">if reach max number of retry, send push noti to customer to ask them try again later</text><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="632.5" y1="598.123" y2="598.123"/><line style="stroke:#181818;stroke-width:1.0;" x1="632.5" x2="632.5" y1="598.123" y2="611.123"/><line style="stroke:#181818;stroke-width:1.0;" x1="591.5" x2="632.5" y1="611.123" y2="611.123"/><polygon fill="#181818" points="601.5,607.123,591.5,611.123,601.5,615.123,597.5,611.123" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="597.5" y="593.3809">Update inventory</text><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="632.5" y1="640.4336" y2="640.4336"/><line style="stroke:#181818;stroke-width:1.0;" x1="632.5" x2="632.5" y1="640.4336" y2="653.4336"/><line style="stroke:#181818;stroke-width:1.0;" x1="591.5" x2="632.5" y1="653.4336" y2="653.4336"/><polygon fill="#181818" points="601.5,649.4336,591.5,653.4336,601.5,657.4336,597.5,653.4336" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="597.5" y="635.6914">Calculate waiting time and position in queue</text><polygon fill="#181818" points="1293,678.7441,1303,682.7441,1293,686.7441,1297,682.7441" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1299" y1="682.7441" y2="682.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="597.5" y="678.002">Enqueue order</text><polygon fill="#181818" points="220.5,708.0547,210.5,712.0547,220.5,716.0547,216.5,712.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="579.5" y1="712.0547" y2="712.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="226.5" y="707.3125">Update order with position and waiting time</text><polygon fill="#181818" points="1134.5,737.3652,1144.5,741.3652,1134.5,745.3652,1138.5,741.3652" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="590.5" x2="1140.5" y1="741.3652" y2="741.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="597.5" y="736.623">Send confirmation push noti to customer</text><polygon fill="#181818" points="1446,766.6758,1456,770.6758,1446,774.6758,1450,770.6758" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1452" y1="770.6758" y2="770.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="592.5" y="765.9336">Ack message</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1656" x="0" y="799.3311"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="799.3311" y2="799.3311"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1656" y1="802.3311" y2="802.3311"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="267" x="694.5" y="788.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="253" x="700.5" y="805.2441">Start processing order in background</text><polygon fill="#181818" points="1293,839.2969,1303,843.2969,1293,847.2969,1297,843.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1299" y1="843.2969" y2="843.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="592.5" y="838.5547">Dequeue order</text><polygon fill="#181818" points="1581,868.6074,1591,872.6074,1581,876.6074,1585,872.6074" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1587" y1="872.6074" y2="872.6074"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="592.5" y="867.8652">Send message process order to SQS queue</text><polygon fill="#181818" points="1134.5,897.918,1144.5,901.918,1134.5,905.918,1138.5,901.918" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1140.5" y1="901.918" y2="901.918"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="592.5" y="897.1758">Send start processing push noti to customer</text><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="627.5" y1="931.2285" y2="931.2285"/><line style="stroke:#181818;stroke-width:1.0;" x1="627.5" x2="627.5" y1="931.2285" y2="944.2285"/><line style="stroke:#181818;stroke-width:1.0;" x1="586.5" x2="627.5" y1="944.2285" y2="944.2285"/><polygon fill="#181818" points="596.5,940.2285,586.5,944.2285,596.5,948.2285,592.5,944.2285" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="592.5" y="926.4863">Process order</text><polygon fill="#181818" points="220.5,969.5391,210.5,973.5391,220.5,977.5391,216.5,973.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="584.5" y1="973.5391" y2="973.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352" x="226.5" y="968.7969">Update other orders in queue : position and wating time</text><polygon fill="#181818" points="220.5,998.8496,210.5,1002.8496,220.5,1006.8496,216.5,1002.8496" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="584.5" y1="1002.8496" y2="1002.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="226.5" y="998.1074">Update order with status READY_FOR_PICKUP</text><polygon fill="#181818" points="1134.5,1028.1602,1144.5,1032.1602,1134.5,1036.1602,1138.5,1032.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1140.5" y1="1032.1602" y2="1032.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="592.5" y="1027.418">Send order ready push noti to customer</text><polygon fill="#181818" points="1581,1057.4707,1591,1061.4707,1581,1065.4707,1585,1061.4707" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="1587" y1="1061.4707" y2="1061.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="592.5" y="1056.7285">Ack message</text><!--MD5=[1dce827bdb16bded6e70cce2cf2efe4d]
@startuml
title Customer place order
participant Channel as "Mobile Channel"
participant OrderService as "Order Service"
participant ShopService as "Shop Service"
participant NotificationService as "Notification Service"
participant QueueManagement as "Queue Management"
queue OrderPlacementQueue as "Order Placement\nQueue"
queue OrderProcessQueue as "Order Process\nQueue"

== Start customer place order process==
Channel -> OrderService : Initialize new order
activate OrderService
OrderService -> OrderService : Generate order id, create new record in DynamoDB
OrderService -> OrderPlacementQueue : Send message of new order to SQS queue
return Return order id
deactivate OrderService

== Start confirming order in background==
ShopService -> OrderPlacementQueue : Poll new message
activate ShopService
ShopService -> ShopService : Validate order details : item availability, calculate total cost
ShopService -> QueueManagement : Check for available waiting queue

alt #Azure "Found available waiting queue"
ShopService -> ShopService : Store order with queue id
end alt
alt #Wheat "All queue are at maximum capacity"
ShopService -> OrderPlacementQueue : use retry mechanism of SQS to look for available queue
ShopService -> NotificationService : if reach max number of retry, send push noti to customer to ask them try again later
end alt

ShopService -> ShopService : Update inventory
ShopService -> ShopService : Calculate waiting time and position in queue
ShopService -> QueueManagement : Enqueue order
ShopService -> OrderService : Update order with position and waiting time
ShopService -> NotificationService : Send confirmation push noti to customer
ShopService -> OrderPlacementQueue : Ack message
deactivate ShopService

== Start processing order in background==
ShopService -> QueueManagement : Dequeue order
ShopService -> OrderProcessQueue : Send message process order to SQS queue
ShopService -> NotificationService : Send start processing push noti to customer
ShopService -> ShopService : Process order
ShopService -> OrderService : Update other orders in queue : position and wating time
ShopService -> OrderService : Update order with status READY_FOR_PICKUP
ShopService -> NotificationService : Send order ready push noti to customer
ShopService -> OrderProcessQueue : Ack message
@enduml

PlantUML version 1.2022.7(Tue Aug 23 00:01:30 ICT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: VN
--></g></svg>